<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Escala da Sonoplastia</title>
<link rel="stylesheet" href="css/escala.css">
<link rel="icon" type="image/png" href="imagens/channels4_profile.jpg">
</head>
<body>
    <header>
        <img src="imagens/logo.png">
        <div class="links">
        <a class="cabecalho" href="">Todos materiais</a>
        <a class="cabecalho" href="https://www.canva.com/design/DAGwv-G0l2c/OuW_SzLTfpPebx_5-tf0FA/edit?utm_content=DAGwv-G0l2c&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton" target="_blank">Canva</a>
        <a class="cabecalho" href="index.html">Casa</a>
        </div>
    </header>
<h1>Escala da Sonoplastia</h1>
<div id="resultado"></div>

<script>
(function() {
    const escala = [];
    const horasPorDia = { "Domingo": "18:30", "Quarta": "19:30", "Sábado": "08:30" };
    const diasUteis = ["Domingo", "Quarta", "Sábado"];
    const diasSemana = ["Domingo", "Segunda", "Terça", "Quarta", "Quinta", "Sexta", "Sábado"];

    const hoje = new Date();
    const mesAtual = hoje.getMonth() + 1; // 1..12
    const anoAtual = hoje.getFullYear();
    const chaveEscala = `escala_${mesAtual}_${anoAtual}`;

    // Se já existir escala salva para o mês, mostra
    const escalaSalva = localStorage.getItem(chaveEscala);
    if (escalaSalva) {
        const dados = JSON.parse(escalaSalva);
        escreverNoHTML(dados, mesAtual);
    }

    // Modo administrador
    window.entrarAdmin = function(senha) {
        if (senha === "SENHA_SUPER_SECRETA") {
            alert("Bem-vindo, administrador! Iniciando cadastro de escalas...");
            cadastrarEscalas();
        } else {
            alert("Senha incorreta!");
        }
    };

    function cadastrarEscalas() {
        const ultimoDiaDoMes = new Date(anoAtual, mesAtual, 0).getDate();

        // Lista TODAS as datas do mês que sejam Domingo/Quarta/Sábado (sem pular)
        const datasFiltradas = [];
        for (let dia = 1; dia <= ultimoDiaDoMes; dia++) {
            const data = new Date(anoAtual, mesAtual - 1, dia);
            const nomeDia = diasSemana[data.getDay()];
            if (diasUteis.includes(nomeDia)) {
                datasFiltradas.push({ dia, diaSemana: nomeDia });
            }
        }
        // Já vêm em ordem crescente, mas garantimos:
        datasFiltradas.sort((a, b) => a.dia - b.dia);

        // Cadastro dos nomes para cada data
        const novaEscala = [];
        for (const diaObj of datasFiltradas) {
            const dataFormatada = `${String(diaObj.dia).padStart(2, '0')}/${String(mesAtual).padStart(2, '0')}/${anoAtual}`;
            const hora = horasPorDia[diaObj.diaSemana];

            let nomes = [];
            alert(`Cadastrando escala para ${diaObj.diaSemana} = ${dataFormatada}`);
            for (let j = 0; j < 4; j++) {
                const nome = prompt(`Digite o nome da pessoa ${j + 1} (ou digite "parar" para encerrar):`);
                if (!nome || nome.toLowerCase() === "parar") break;
                nomes.push(nome.trim());
            }

            novaEscala.push({
                data: dataFormatada,
                diaSemana: diaObj.diaSemana,
                nomes,
                hora
            });
        }

        // Salva e renderiza
        localStorage.setItem(chaveEscala, JSON.stringify(novaEscala));
        escreverNoHTML(novaEscala, mesAtual);
    }

    function escreverNoHTML(dados, mes) {
        const resultado = document.getElementById('resultado');
        let html = `<h1>Escala do mês ${mes}</h1>
                    <table>
                        <thead>
                            <tr>
                                <th class="titulos, titulos1">Data</th>
                                <th class="titulos">Dia</th>
                                <th class="titulos">Nomes</th>
                                <th class="titulos, titulos4">Hora</th>
                            </tr>
                        </thead>
                        <tbody>`;
        dados.forEach(e => {
            const nomes = (e.nomes && e.nomes.length) ? e.nomes.join(", ") : "-";
            html += `<tr>
                        <td>${e.data}</td>
                        <td>${e.diaSemana}</td>
                        <td>${nomes}</td>
                        <td>${e.hora || ""}</td>
                    </tr>`;
        });
        html += `</tbody></table>`;
        resultado.innerHTML = html;
    }
})();

window.baixarPDF = function() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const tabela = document.querySelector("#resultado table");
    if (!tabela) {
        alert("Nenhuma escala encontrada para exportar!");
        return;
    }

    doc.setFontSize(16);
    doc.text("Escala da Sonoplastia", 14, 20);

    doc.autoTable({
        html: tabela,
        startY: 30,
        theme: 'grid',
        styles: { fontSize: 10 }
    });

    doc.save("escala_sonoplastia.pdf");
};
</script>
    <button onclick="baixarPDF()">Baixar escala em PDF</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</body>
</html>
